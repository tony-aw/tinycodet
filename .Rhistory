library(tinycodet)
library(ggplot2)
# stri_locate_ith vs first/last
n <- 1e5
x <- rep(paste0(1:50, collapse = ""), n)
p <- "\\d"
i <- -1
foo <- bench::mark(
stri_locate_ith_regex(x, p, -1),
stringi::stri_locate_last(x, regex = p),
min_iterations = 100
)
foo
autoplot(foo)
?tinycodet::str_search
?rep.int
rep.int(1.0, 2)
rep.int(1.0, 2) |> class()
rep.int(1.0, 2) |> is.integer()
pmax
library(tinycodet)
foo <- crandep::get_dep_all_packages()
unique(foo$type)
foo <- foo[foo$type == "linking to",]
unique(foo$to)
?tinycodet::stri_locate_ith()
?collapse::setattrib()
collapse::unattrib
x <- 1:1e6
names(x) <- sample(letters, 1e6, TRUE)
x <- 1:1e6
names(x) <- sample(letters, 1e6, TRUE)
y <- 1e6:1
names(y) <- sample(letters, 1e6, TRUE)
tempfun <- function(x, y) {
attributes(x) <- NULL
attributes(y) <- NULL
return(x == y)
}
tempfun <- function(x, y) {
attributes(x) <- NULL
attributes(y) <- NULL
return(x == y)
}
foo <- bench::mark(
x == y,
tempfun(x, y),
min_iterations = 200,
check = FALSE
)
foo
Rcpp::cppFunction(
"
LogicalVector rcpp_ntt_equal_dbl(
NumericVector x, NumericVector y, int tol
) {
int n = x.length();
LogicalVector out(n);
out = fabs(x - y) < tol;
return out;
}
"
)
Rcpp::cppFunction(
"
LogicalVector rcpp_ntt_equal_dbl(
NumericVector x, NumericVector y, int tol
) {
int n = x.length();
LogicalVector out(n);
out = fabs(x - y);
return out;
}
"
)
?`==`
setwd("D:/D Desktop/Publications/R package tinycodet/tinycodet")
dimtypes <- c("00", "01", "10")
declareleft <- c("NumericVector", "NumericVector", "double")
declareright <- c("NumericVector", "double", "NumericVector")
declarelength <- c("x.length()", "x.length()", "y.length()")
accessleft <- c("x[i]", "x[i]", "x")
accessright <- c("y[i]", "y", "y[i]")
templatecode  <- "
//' @keywords internal
//' @noRd
// [[Rcpp::export(.rcpp_ntt_greatersmaller_dbl_DIM)]]
LogicalVector rcpp_ntt_greatersmaller_dbl_DIM(
DECLARELEFT x, DECLARERIGHT y, double tol, bool greater
) {
R_xlen_t n = DECLARELENGTH;
LogicalVector out(n);
if(greater) {
for(R_xlen_t i = 0; i < n; ++i) {
out[i] = ACCESSLEFT > ACCESSRIGHT;
}
} else {
for(R_xlen_t i = 0; i < n; ++i) {
out[i] = ACCESSLEFT < ACCESSRIGHT;
}
}
return out;
}
"
rcpp_scripts <- character(length(dimtypes))
names(rcpp_scripts) <- dimtypes
for(i in seq_along(dimtypes)) {
rcpp_scripts[[i]] <- stri_replace_all(
templatecode,
fixed = c("DIM", "DECLARELEFT", "DECLARERIGHT", "DECLARELENGTH", "ACCESSLEFT", "ACCESSRIGHT"),
replacement = c(dimtypes[i], declareleft[i], declareright[i], declarelength[i], accessleft[i], accessright[i]),
case_insensitive = FALSE,
vectorize_all = FALSE
)
}
library(stringi)
dimtypes <- c("00", "01", "10")
declareleft <- c("NumericVector", "NumericVector", "double")
declareright <- c("NumericVector", "double", "NumericVector")
declarelength <- c("x.length()", "x.length()", "y.length()")
accessleft <- c("x[i]", "x[i]", "x")
accessright <- c("y[i]", "y", "y[i]")
templatecode  <- "
//' @keywords internal
//' @noRd
// [[Rcpp::export(.rcpp_ntt_greatersmaller_dbl_DIM)]]
LogicalVector rcpp_ntt_greatersmaller_dbl_DIM(
DECLARELEFT x, DECLARERIGHT y, double tol, bool greater
) {
R_xlen_t n = DECLARELENGTH;
LogicalVector out(n);
if(greater) {
for(R_xlen_t i = 0; i < n; ++i) {
out[i] = ACCESSLEFT > ACCESSRIGHT;
}
} else {
for(R_xlen_t i = 0; i < n; ++i) {
out[i] = ACCESSLEFT < ACCESSRIGHT;
}
}
return out;
}
"
rcpp_scripts <- character(length(dimtypes))
names(rcpp_scripts) <- dimtypes
for(i in seq_along(dimtypes)) {
rcpp_scripts[[i]] <- stri_replace_all(
templatecode,
fixed = c("DIM", "DECLARELEFT", "DECLARERIGHT", "DECLARELENGTH", "ACCESSLEFT", "ACCESSRIGHT"),
replacement = c(dimtypes[i], declareleft[i], declareright[i], declarelength[i], accessleft[i], accessright[i]),
case_insensitive = FALSE,
vectorize_all = FALSE
)
}
headers <- "
#include <Rcpp.h>
using namespace Rcpp;
"
rcpp_code <- paste(c(headers, rcpp_scripts), collapse = "\n\n\n")
cat(rcpp_code)
fileConn <- file("src/dynamic_rcpp_ntt_greatersmaller_dbl.cpp")
writeLines(rcpp_code, fileConn)
close(fileConn)
dimtypes <- c("00", "01", "10")
declareleft <- c("IntegerVector", "IntegerVector", "int")
declareright <- c("IntegerVector", "int", "IntegerVector")
declarelength <- c("x.length()", "x.length()", "y.length()")
accessleft <- c("x[i]", "x[i]", "x")
accessright <- c("y[i]", "y", "y[i]")
dimtypes <- c("00", "01", "10")
declareleft <- c("IntegerVector", "IntegerVector", "int")
declareright <- c("IntegerVector", "int", "IntegerVector")
declarelength <- c("x.length()", "x.length()", "y.length()")
accessleft <- c("x[i]", "x[i]", "x")
accessright <- c("y[i]", "y", "y[i]")
templatecode <- "
//' @keywords internal
//' @noRd
// [[Rcpp::export(.rcpp_ntt_greatersmaller_int_DIM)]]
LogicalVector rcpp_ntt_greatersmaller_int_DIM(
DECLARELEFT x, DECLARERIGHT y, bool greater
) {
R_xlen_t n = DECLARELENGTH;
LogicalVector out(n);
if(greater)) {
for(R_xlen_t i = 0; i < n; ++i) {
out[i] = ACCESSLEFT > ACCESSRIGHT;
}
} else {
for(R_xlen_t i = 0; i < n; ++i) {
out[i] = ACCESSLEFT < ACCESSRIGHT;
}
}
return out;
}
"
rcpp_scripts <- character(length(dimtypes))
names(rcpp_scripts) <- dimtypes
for(i in seq_along(dimtypes)) {
rcpp_scripts[[i]] <- stri_replace_all(
templatecode,
fixed = c("DIM", "DECLARELEFT", "DECLARERIGHT", "DECLARELENGTH", "ACCESSLEFT", "ACCESSRIGHT"),
replacement = c(dimtypes[i], declareleft[i], declareright[i], declarelength[i], accessleft[i], accessright[i]),
case_insensitive = FALSE,
vectorize_all = FALSE
)
}
headers <- "
#include <Rcpp.h>
using namespace Rcpp;
"
rcpp_code <- paste(c(headers, rcpp_scripts), collapse = "\n\n\n")
cat(rcpp_code)
fileConn <- file("src/dynamic_rcpp_ntt_greatersmaller_int.cpp")
writeLines(rcpp_code, fileConn)
close(fileConn)
